<!DOCTYPE html>
<html>
<head>
  <title>test API</title>
</head>
<body>
  <script src="./yypkg.js"></script>
  <script>
  const $history = []

  const { API } = YYPKG

  const urls = {
    test1: '/mock/a3e67a40-863c-11e7-9085-0ba4558c07dc',
    test2: {
      method: 'JSONP',
      url: '/mock/a3e67a40-863c-11e7-9085-0ba4558c07dc',
      mock: 'https://legox.org/mock/a3e67a40-863c-11e7-9085-0ba4558c07dc',
      throttle: 3000
    },
    test3: {
      url: '/mock/a3e67a40-863c-11e7-9085-0ba4558c07dc',
      isMock: false,
      method: 'SDK'
    },
    test4: {
      url: '/mock/:id',
      engine: 'fetch'
    },
    testError: 'https://google.com/',
  }

  const options = {
    engine: 'axios',
    method: 'GET',
    isMock: true,
    isRecordHistory: true,
    baseURL: 'https://legox.org',
    RESTful: true
  }

  const api = new API(urls, options, $history)

  api.$method('axios', engine => engine.SDK = () => new Promise(resolve => {
      setTimeout(() => resolve({code: 1}), 2000)
  }))

  // api.$on('interceptor:beforeResolveOptions', ({ key, url, data, options, namedOptions }) => {
  //   options = JSON.parse(JSON.stringify(data))
  //   data = options.data

  //   // console.log('interceptor:beforeResolveOptions', options)
  //   return { options, data }
  // })

  // api.$on('interceptor:beforeRequest', (options) => {
  //   console.log('interceptor:beforeRequest', options)
  // })

  // api.$on('interceptor:beforeCallbackResponse', (options, response) => {
  //   console.log('interceptor:beforeCallbackResponse', response)
  // })

  // api.$on('interceptor:afterCallbackResponse', (options, response) => {
  //   console.log('interceptor:afterCallbackResponse', response)
  // })

  // api.$on('error', (error) => {
  //   console.log('error', error)
  // })

  ;(async () => {
    // console.log(api.test1)
    // console.log(await api.test1({ method: 'JSONP', params: { test: 1 } }))
    // console.log(await api.test1({ method: 'POST', data: { test: 1 } }))
    // console.log(await api.test1({ test: 1 }, { method: 'GET' }))
    // console.log(await api.test2())
    // console.log(await api.test3())
    // console.log(await (await api.test4({}, { keys: { id: 'a3e67a40-863c-11e7-9085-0ba4558c07dc' } })).json())
    // console.log(api.$history)
    // console.log($history)
    // console.log(await api.testError())
  })()

  async function clickBtn1 () {
    console.log(api.test1.get(null, {params: {test:1}}))
    console.log(api.test1.get(null, {params: {test:2}}))
    // console.log( api.test1.post())
    // console.log(await api.test1())
  }

  async function clickBtn2 () {
    console.log(await api.test2())
  }

  function showHistory () {
    console.log($history)
  }
  </script>

  <button onclick="clickBtn1()">test 1</button>
  <button onclick="clickBtn2()">test 2</button>
  <button onclick="showHistory()">$history</button>
</body>
</html>
